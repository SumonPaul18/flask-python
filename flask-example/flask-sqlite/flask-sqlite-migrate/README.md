?? ???????? ??????? ??? ??? ??? ???? ????? ????? ???? ???? ???? ??? ?????? ?????? ???????? ??? ?????????? ??????? ??????? ??? ?????? ???? ????, ?????? ??????? ????????? ???? ??? ???? ???? ?????? ???????? ??? ????

### ??????

#### ?. ??????? ???? ???? ???? ??? ??????? ???? ???

??? ???? ??????????? ???????? ????? ??? ???????? ???? ???????????? ???? ?? ????, ????? ???? ??????? ?????? ???? ???? ??????? ???? ???? ?????:
```bash
rm site.db
```

????, ?????????????? ??????? ???? ???? ???? `db.create_all()` ???????? ???? ??????? ???? ???? ????

#### ?. Flask-Migrate ??????? ???

Flask-Migrate ??????? ??? ??????? ????????? ???????? ???? ?????? ??? ??????? ?????? ???????? ??? ??? ?????

**?????????**:
```bash
pip install Flask-Migrate
```

**??????????**:
```python
from flask import Flask, render_template, request, redirect, url_for
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///site.db'
db = SQLAlchemy(app)
migrate = Migrate(app, db)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    number = db.Column(db.String(20), nullable=True)  # ???? ???? ??? ???

    def __repr__(self):
        return f'<User {self.username}>'

@app.before_first_request
def create_tables():
    db.create_all()

@app.route('/')
def index():
    users = User.query.all()
    return render_template('index.html', users=users)

@app.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        username = request.form['username']
        email = request.form['email']
        number = request.form['number']
        new_user = User(username=username, email=email, number=number)
        db.session.add(new_user)
        db.session.commit()
        return redirect(url_for('index'))
    return render_template('register.html')

if __name__ == '__main__':
    app.run(debug=True)
```

**????????? ?????? ??????? ???**:
```bash
flask db init
flask db migrate -m "Add number column to User model."
flask db upgrade
```

### ???? ????? ???

**register.html** ????? ???? ????? ??? ????:
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
</head>
<body>
    <h1>Register</h1>
    <form method="POST" action="">
        {{ form.hidden_tag() }}
        <p>
            {{ form.username.label }}<br>
            {{ form.username(size=32) }}<br>
            {% for error in form.username.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
        </p>
        <p>
            {{ form.email.label }}<br>
            {{ form.email(size=32) }}<br>
            {% for error in form.email.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
        </p>
        <p>
            <label for="number">Number:</label><br>
            <input type="text" id="number" name="number" size="32"><br>
        </p>
        <p>{{ form.submit() }}</p>
    </form>
</body>
</html>
```

?? ????????, ???? ???? ?????? ???????? ??? ???? ???????

---

#### Docker ??????? ??? ???????????? ?????????

???? ??? Docker ??????? ????, ????? Dockerfile ??? docker-compose.yml ?????? ??????? ????????? ???????????? ???????????? ???? ??????

**Dockerfile**:
```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt

COPY . .

CMD ["python", "migrate.py"]
```

**docker-compose.yml**:
```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "5000:5000"
    environment:
      FLASK_APP: migrate.py
      FLASK_ENV: development
```

### ?. Docker ?????? ??????? ???

Docker ?????? ??????? ??? ????????? ???? ??? ??? ????:
```bash
docker-compose up --build
```

?? ????????, ????? ????????? ???????????? ???????????????? ??????? ??? ???? ???? ????? ?????????????? ??? ?????? ??? ????? ??? ???? ?????? ???? ?? ??????? ????? ???, ?????? ?????!

---
#### Error:
`
flask db migrate -m "Add number column to User mode2l." C:\Users\Sumon\AppData\Local\Programs\Python\Python311\Lib\site-packages\flask_sqlalchemy\__init__.py:834: FSADeprecationWarning: SQLALCHEMY_TRACK_MODIFICATIONS adds significant overhead and will be disabled by default in the future. Set it to True or False to suppress this warning. warnings.warn(FSADeprecationWarning( INFO [alembic.runtime.migration] Context impl SQLiteImpl. INFO [alembic.runtime.migration] Will assume non-transactional DDL. ERROR [root] Error: Target database is not up to date.
`

?? ???????? ??????? ??? ??? ??? ????? ??????? ??? ????????? ????????? ????? ?????? ?????? ?? ????? ??? ?????? ???? ????, ?????? ???? ????? ?????? ???? ????

### ??????

#### ?. ??????? ????????? ???? ???? ????

????? ????????? ???????? ????? ??????? ????????? ?????? ???? ?????? ??? ??????? `migrations/versions` ?????????? ????? ?????

#### ?. `alembic_version` ????? ????? ???

???????? `alembic_version` ??????? ????? ???? ???? ??? ??????? ??? ????????? ???????? ???? ???? ???? ??? ??????????? ???? ????? ???? ????? ???????? ??????? ???? ?????:
```bash
flask db stamp head
```

#### ?. ???? ????????? ???? ???

???? ????????? ???? ???? ????:
```bash
flask db migrate -m "Add number column to User model."
```

#### ?. ??????? ??????? ???

??????? ??????? ????:
```bash
flask db upgrade
```

### ???????? ??? ??????

????? `app.py` ?????? ????? ??? ??? ????:
```python
from flask import Flask, render_template, request, redirect, url_for
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///site.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False  # Warning ??? ???? ????
db = SQLAlchemy(app)
migrate = Migrate(app, db)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    number = db.Column(db.String(11), nullable=True)  # ???? ????

    def __repr__(self):
        return f'<User {self.username}>'

@app.before_first_request
def create_tables():
    db.create_all()

@app.route('/')
def index():
    users = User.query.all()
    return render_template('index.html', users=users)

@app.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        username = request.form['username']
        email = request.form['email']
        number = request.form['number']
        new_user = User(username=username, email=email, number=number)
        db.session.add(new_user)
        db.session.commit()
        return redirect(url_for('index'))
    return render_template('register.html')

if __name__ == '__main__':
    app.run(debug=True)
```

### ???? ????? ???

**register.html** ????? ???? ????? ??? ????:
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
</head>
<body>
    <h1>Register</h1>
    <form method="POST" action="">
        <p>
            <label for="username">Username:</label><br>
            <input type="text" id="username" name="username" required><br>
        </p>
        <p>
            <label for="email">Email:</label><br>
            <input type="email" id="email" name="email" required><br>
        </p>
        <p>
            <label for="number">Number:</label><br>
            <input type="text" id="number" name="number"><br>
        </p>
        <p><button type="submit">Register</button></p>
    </form>
</body>
</html>
```

?? ????????, ???? ????? ?????? ??????? ????? ?? ???? ???? ???? ??? ???? ?????? ??? ?????????????? ???????? ??? ???? ??????[1](https://github.com/miguelgrinberg/Flask-Migrate/issues/444)[2](https://github.com/miguelgrinberg/Flask-Migrate/issues/233)[3](https://blog.csdn.net/qq_35972181/article/details/104592477). ??? ????? ??? ???? ?????? ???? ?? ??????? ????? ???, ?????? ?????!